# 组件拆分

## 为什么分享react组件开发

在老的项目中，我们用的是Angularjs1+jquery，给我的感觉分为以下几个点：

1. 单个文件js代码量巨大。这个还是用了Angularjs情况，动着就是上千行的代码，要是一条一条看完这个日子没法过了。
2. 代码注释少，且不规范。大段大段的代码，逻辑及其复杂，以前是为了敢进度，很多代码根本就没写注释，很多逻辑不结合prd根本不知所云，这样的代码我在上一家公司也遇到过，如果公司产品换得勤快一点，需求再一改锅就出来了。
3. 逻辑耦合。很多单独的功能写在了一起，该拆分的功能为拆分，导致后面的人想拆分的时候不敢下手。
4. css、js、html单独分离，模块化力度不够。整个系统如果要修改一个样式文案，需要从在html、css、js三种文件中单独查找，找到后还要将其一一对应起来，降低了开发效率。

### 新的项目的愿景

* 用reactjs开发，但页面应用减少很多重复性的代码，提高用户体验。
* 组件化开发，实现功能、模块、组件的拆分，降低后期维护的成本。
* 运用一些优秀UI库，取消对低版本浏览器的兼容，提高开发效率。

### 实际项目迁移中
* 组件复用上，自己开发自己的，有些组件未实现复用：上传组件，密码验证组件，图片验证组件，手机号码验证组件。
* 代码逻辑上，很多页面的代码逻辑是直接拷贝过来，未进行深加工，同时在迁移过程中为了赶时间，导致逻辑臃肿。
* 代码注释上，很多地方只是迁移逻辑注释未添加，导致后面维护的人维护困难。

## 如何解决
针对上面的一些问题，我这个这里总结一下我们用过如何解决上面的问题，提高我们的开发效率。

* 组件拆分
* 代码规范
* 技能运用

## 
首先，我们在组件的拆分上要更细粒度，同时要实现高内聚力低耦合。拆分组件的需要注意以下几点。

### 单一
要想设计一个好的组件，组件也需要专一。

设计组件要遵循一个原则：一个组件只专注做一件事，且把这件事做好。

一个功能如果可以拆分成多个功能点，那就可以将每个功能点封装成一个组件，当然也不是组件的颗粒度越小越好，只要将一个组件内的功能和逻辑控制在一个可控的范围内即可。

举个例子。页面上有一个 Table 列表和一个分页控件，就可以将 Table 封装为一个组件，分页控件 封装成一个组件，最后再把 Table组件 和 分页组件 封装成一个组件。Table 组件还可以再拆分成多个 table-column 组件，及展示逻辑等。

### 可配置性

一个组件，要明确它的输入和输出分别是什么。

组件除了要展示默认的内容，还需要做一些动态的适配，比如：一个组件内有一段文本，一个图片和一个按钮。那么字体的颜色、图片的规则、按钮的位置、按钮点击事件的处理逻辑等，都是可以做成可配置的。

要做可配置性，最基本的方式是通过属性向组件传递配置的值，而在组件初始化的声明周期内，通过读取属性的值做出对应的显示修改。还有一些方法，通过调用组件暴露出来的函数，向函数传递有效的值；修改全局 CSS样式；向组件传递特定事件，并在组件内监听该事件来执行函数等。

在做可配置性时，为了让组件更加健壮，保证组件接收到的是有效的属性、函数接收到的是有效的参数，需要做一些校验。

### 生命周期

一个组件，需要明确知道在生命周期的不同阶段做该做的事。

初始化阶段，读取属性的值，如果需要做数据和逻辑处理的话，在这个阶段进行。

属性值变化时，如果属性发生变化，且需要对变化后的数据进行处理的话，在这个阶段进行处理。

组件销毁阶段，如果组件已经创建了一些可能会对系统产生一些副作用的东西，可以在这个阶段进行清除。比如 timeInterval、timeout 等。

如果组件在渲染的时候报错，需要展示错误信息。React v16 中提供了 componentDidCatch 生命周期函数，Vue v2.5 中提供了 errorCaptured 的钩子函数。

React 中提供了一些生命周期函数：
componentWillMount，componentDidMount，componentWillReceiveProps，shouldComponentUpdate，componentWillUpdate，componentDidUpdate，render，componentWillUnmount，componentDidCatch(React v16)。

Vue 中提供了一些生命周期函数：beforeCreate，created，beforeMount，mounted，beforeUpdate，updated，beforeDestroy，destroyed，errorCapture，errorCaptured(Vue v2.5)。

每个生命周期的具体用法，请参考官方详细文档。

### 事件传递

而在 React 中，官方没有给出组件间的事件传递解决方案，这也是 React 中比较坑的一点。不过，还是可以使用其他方式来实现。

React 中，父组件可以使用 props 向子组件传值，而子组件向父组件传值，需要在父组件内定义函数并通过属性传递给子组件，在子组件内通过调用该属性对应的函数，传入参数，传递给父组件内的函数，并在父组件的该函数中做逻辑的处理。

如果传递层级太多，可以考虑redux来进行状态传递

## 代码规范

我们的react项目大部分是由组件组成，在开发的过程中我们可能会复用很多的组件或者方法。这个就要求我们想复用代码的时候能快速的找到我们的想复用的代码，并知道如何去复用。

### 组件文档

我们用的antd为我们提供了一个基础组件库，这个我就不多介绍了。

剩下的就是需要在我们的项目中建设我们的组件文档，在项目中我们结合了``react-styleguide``来生成我们的项目相关的组件文档，我们只需要按``styleguide``的规范对个编写一个readme文件即可为我们的组件提供一个类似antd的组件文档。

### 组件注释

在没个组件中，需要把组件的描述，组件创建时间和作者写清楚，方便我们在日后快速的定位问题，并快拿出解决方案。

### 组件传递参数
在组件中，我们需要用proptypes来规范我们的参数传入格式，方便我们调用组件，并生成组件文档，快速定位问题。



### 在新项目中我们应该如何梳理我们的逻辑



